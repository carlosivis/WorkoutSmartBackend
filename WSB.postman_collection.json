{
  "info": {
    "_postman_id": "workout-smart-backend",
    "name": "WorkoutSmart Backend & Token Gen",
    "description": "Collection para testar o backend Kotlin com gerador de tokens do Firebase embutido.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "0. Setup (Token Generation)",
      "item": [
        {
          "name": "Get Real Firebase Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "if (jsonData.idToken) {",
                  "    pm.collectionVariables.set(\"jwt_token\", jsonData.idToken);",
                  "    console.log(\"Token atualizado com sucesso!\");",
                  "} else {",
                  "    console.error(\"Falha ao obter token\", jsonData);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"{{firebase_email}}\",\n    \"password\": \"{{firebase_password}}\",\n    \"returnSecureToken\": true\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key={{firebase_web_api_key}}",
              "protocol": "https",
              "host": [
                "identitytoolkit",
                "googleapis",
                "com"
              ],
              "path": [
                "v1",
                "accounts:signInWithPassword"
              ],
              "query": [
                {
                  "key": "key",
                  "value": "{{firebase_web_api_key}}"
                }
              ]
            },
            "description": "Troca email/senha por um ID Token válido do Google e salva na variável {{jwt_token}}."
          },
          "response": []
        }
      ]
    },
    {
      "name": "1. Auth (Backend)",
      "item": [
        {
          "name": "Sync User (Login)",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"{{firebase_email}}\",\n    \"displayName\": \"Tester Postman\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/auth/login",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "auth",
                "login"
              ]
            },
            "description": "Sincroniza o usuário do Firebase com o banco Postgres."
          },
          "response": []
        }
      ]
    },
    {
      "name": "2. Groups",
      "item": [
        {
          "name": "Create Group",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "if(jsonData.groupId) {",
                  "    pm.collectionVariables.set(\"last_group_id\", jsonData.groupId);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"name\": \"Grupo de Teste Postman\",\n    \"description\": \"Criado via API\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/groups",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "groups"
              ]
            }
          },
          "response": []
        },
        {
          "name": "List User Groups",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/groups",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "groups"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Join Group (Invite Code)",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"inviteCode\": \"XJ9-22A\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/groups/join",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "groups",
                "join"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Get Ranking",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/groups/{{last_group_id}}/ranking",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "groups",
                "{{last_group_id}}",
                "ranking"
              ]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "3. Activities",
      "item": [
        {
          "name": "Log Activity",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"type\": \"GYM\",\n    \"description\": \"Supino Reto\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/activities",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "activities"
              ]
            }
          },
          "response": []
        }
      ]
    }
  ],
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{jwt_token}}",
        "type": "string"
      }
    ]
  },
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          ""
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          ""
        ]
      }
    }
  ],
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:8080",
      "type": "string"
    },
    {
      "key": "firebase_web_api_key",
      "value": "COLE_SUA_API_KEY_AQUI",
      "type": "string"
    },
    {
      "key": "firebase_email",
      "value": "seu_email_teste@gmail.com",
      "type": "string"
    },
    {
      "key": "firebase_password",
      "value": "sua_senha_teste",
      "type": "string"
    },
    {
      "key": "jwt_token",
      "value": "",
      "type": "string"
    },
    {
      "key": "last_group_id",
      "value": "1",
      "type": "string"
    }
  ]
}